#!/usr/bin/env bash
set -e

log() {
    echo "blog-deploy: $1" 1>&2
}

goose() {
    uname | awk '{print tolower($0)}'
}

release() {
    echo "v$(cat VERSION)"
}

BIN_NAME="blog-$(goose)"
BIN_TARGET="./bin/blog"
BIN_URL="https://github.com/arecker/blog/releases/download/$(release)/${BIN_NAME}"

log "downloading $BIN_NAME from latest release"
wget -O "$BIN_TARGET" "$BIN_URL" &> /dev/null

log "making $BIN_TARGET executable"
chmod +x "$BIN_TARGET"

log "running $BIN_TARGET"
"$BIN_TARGET" -all

log "[legacy] building remaining datafiles"
make xml
make data

log "[legacy] building jekyll"
bundle exec jekyll build
