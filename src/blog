#!/usr/bin/env ruby

# frozen_string_literal: true

require 'yaml'

require_relative 'lib/git.rb'

def join(*args)
  rel = File.join(File.dirname(__FILE__), '..', *args)
  File.expand_path rel
end

def log(msg)
  puts "blog :: #{msg}"
end

def version
  IO.read(join('VERSION')).chomp
end

def pages
  Dir.glob(join('_pages/**/*.html'))
end

def nav
  @nav ||= pages.map do |p|
    [File.basename(p, '*.html'), YAML.load_file(p)['nav']]
  end.select(&:all?).sort_by(&:last).collect(&:first)
end

def main
  log "Hi!  I'm blog (v#{version})."
  log "I built the following nav from page data: #{nav.join(', ')}."
  log "The current commit is #{Git.short_head} (#{Git.head_summary})."
end

main if __FILE__ == $PROGRAM_NAME
